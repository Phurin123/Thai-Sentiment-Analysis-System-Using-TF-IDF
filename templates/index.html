<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sentiment Analyzer</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .sentiment-tab {
        font-weight: bold;
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
      }
      .sentiment-tab.active {
        border-bottom-color: #0d6efd;
        color: #0d6efd;
      }
      .btn-analyze {
        background-color: #0d6efd;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
      }
      .result-box {
        border: 1px solid #dee2e6;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
      }
      .label-negative {
        background-color: #f8d7da;
        color: #721c24;
        padding: 5px 10px;
        border-radius: 5px;
      }
      .label-positive {
        background-color: #d4edda;
        color: #155724;
        padding: 5px 10px;
        border-radius: 5px;
      }
      .label-neutral {
        background-color: #fff3cd;
        color: #856404;
        padding: 5px 10px;
        border-radius: 5px;
      }
      .word-tag {
        display: inline-block;
        margin: 5px;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.9em;
      }
      .positive-word {
        background-color: #d4edda;
        color: #155724;
      }
      .neutral-word {
        background-color: #fff3cd;
        color: #856404;
      }
      .negative-word {
        background-color: #f8d7da;
        color: #721c24;
      }
      .progress-bar-container {
        height: 10px;
        background-color: #e9ecef;
        border-radius: 5px;
        margin: 10px 0;
      }
      .progress-bar-fill {
        height: 100%;
        border-radius: 5px;
      }
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #2196f3;
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-4">
      <div class="card shadow-sm p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex gap-3">
            <div class="sentiment-tab active" id="tab-sentiment">Sentiment</div>
            <div class="sentiment-tab" id="tab-topic">Topic</div>
          </div>
          <div class="d-flex align-items-center">
            <span class="me-2">ไทย ▾</span>
            <div class="toggle-switch ms-3">
              <input type="checkbox" id="ab-toggle" checked />
              <span class="slider"></span>
            </div>
            <label for="ab-toggle" class="ms-2">A / B comparison</label>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Text:</label>
          <div class="d-flex flex-wrap gap-2 mb-2">
            <span class="badge bg-light text-dark">Thai slang</span>
            <span class="badge bg-light text-dark">Typos</span>
            <span class="badge bg-light text-dark">Sarcasm</span>
            <div class="dropdown">
              <button
                class="btn btn-sm btn-outline-secondary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
              >
                Neutral-ish ▾
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Neutral-ish</a></li>
                <li><a class="dropdown-item" href="#">Other</a></li>
              </ul>
            </div>
          </div>
          <textarea
            id="input-text"
            class="form-control"
            rows="4"
            placeholder="พิมพ์ข้อความที่ต้องการวิเคราะห์..."
          ></textarea>
        </div>

        <button id="analyze-btn" class="btn-analyze">Analyze</button>

        <div id="results-container" class="mt-4" style="display: none">
          <h5 class="text-center mb-3">Model A and Model B predicted:</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="result-box">
                <h6>Model A predicted:</h6>
                <div id="model-a-label" class="label-negative mb-2">
                  NEGATIVE
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span
                    >Confidence: <span id="model-a-confidence">0.82</span></span
                  >
                  <span>Latency: <span id="model-a-latency">5</span> ms</span>
                </div>
                <div class="progress-bar-container">
                  <div
                    id="model-a-progress"
                    class="progress-bar-fill"
                    style="width: 82%; background-color: #dc3545"
                  ></div>
                </div>
                <p class="mt-3">
                  Model:
                  <span id="model-a-name">sentiment_v1_tfidf_lr • v1.0</span>
                </p>
                <p>Important words:</p>
                <div id="model-a-words" class="d-flex flex-wrap">
                  <!-- คำสำคัญจะถูกใส่โดย JavaScript -->
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="result-box">
                <h6>Model B predicted:</h6>
                <div id="model-b-label" class="label-negative mb-2">
                  NEGATIVE
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span
                    >Confidence: <span id="model-b-confidence">0.84</span></span
                  >
                  <span>Latency: <span id="model-b-latency">6</span> ms</span>
                </div>
                <div class="progress-bar-container">
                  <div
                    id="model-b-progress"
                    class="progress-bar-fill"
                    style="width: 84%; background-color: #dc3545"
                  ></div>
                </div>
                <p class="mt-3">
                  Model:
                  <span id="model-b-name"
                    >sentiment_v2_char_tfidf_lr • v2.1</span
                  >
                </p>
                <p>Important words:</p>
                <div id="model-b-words" class="d-flex flex-wrap">
                  <!-- คำสำคัญจะถูกใส่โดย JavaScript -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const tabSentiment = document.getElementById("tab-sentiment");
        const tabTopic = document.getElementById("tab-topic");
        const analyzeBtn = document.getElementById("analyze-btn");
        const inputText = document.getElementById("input-text");
        const resultsContainer = document.getElementById("results-container");
        const abToggle = document.getElementById("ab-toggle");

        // Tab switching
        tabSentiment.addEventListener("click", () => {
          tabSentiment.classList.add("active");
          tabTopic.classList.remove("active");
        });
        tabTopic.addEventListener("click", () => {
          tabTopic.classList.add("active");
          tabSentiment.classList.remove("active");
        });

        // Analyze button
        analyzeBtn.addEventListener("click", async () => {
          const text = inputText.value.trim();
          if (!text) {
            alert("กรุณากรอกข้อความ!");
            return;
          }

          try {
            const url = abToggle.checked ? "/predict-ab" : "/predict";
            const response = await fetch(url, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ text }),
            });

            if (!response.ok) throw new Error("Request failed");

            const data = await response.json();

            if (abToggle.checked) {
              // A/B mode
              updateResultsAB(data);
            } else {
              // Single model mode
              updateResultsSingle(data);
            }

            resultsContainer.style.display = "block";
          } catch (error) {
            alert("เกิดข้อผิดพลาดในการวิเคราะห์: " + error.message);
          }
        });

        function updateResultsAB(data) {
          const a = data.model_a;
          const b = data.model_b;

          document.getElementById("model-a-label").textContent = a.label;
          document.getElementById("model-a-label").className =
            `label-${a.label.toLowerCase()} mb-2`;
          document.getElementById("model-a-confidence").textContent =
            a.confidence;
          document.getElementById("model-a-latency").textContent = a.latency_ms;
          document.getElementById("model-a-progress").style.width =
            `${a.confidence * 100}%`;
          document.getElementById("model-a-progress").style.backgroundColor =
            a.label === "POSITIVE"
              ? "#28a745"
              : a.label === "NEUTRAL"
                ? "#ffc107"
                : "#dc3545";
          document.getElementById("model-a-name").textContent =
            `${a.model_name} • ${a.version}`;

          document.getElementById("model-b-label").textContent = b.label;
          document.getElementById("model-b-label").className =
            `label-${b.label.toLowerCase()} mb-2`;
          document.getElementById("model-b-confidence").textContent =
            b.confidence;
          document.getElementById("model-b-latency").textContent = b.latency_ms;
          document.getElementById("model-b-progress").style.width =
            `${b.confidence * 100}%`;
          document.getElementById("model-b-progress").style.backgroundColor =
            b.label === "POSITIVE"
              ? "#28a745"
              : b.label === "NEUTRAL"
                ? "#ffc107"
                : "#dc3545";
          document.getElementById("model-b-name").textContent =
            `${b.model_name} • ${b.version}`;

          // ตัวอย่างคำสำคัญ — ควรดึงจาก model จริง แต่ตอนนี้เราจำลอง
          renderWords(
            "model-a-words",
            a.important_words || [],
            a.word_sentiments || [],
          );
          renderWords(
            "model-b-words",
            b.important_words || [],
            b.word_sentiments || [],
          );
        }

        function updateResultsSingle(data) {
          // ถ้าไม่เปิด A/B แสดงแค่ Model A
          const a = data; // ใช้ data จาก /predict
          document.getElementById("model-a-label").textContent = a.label;
          document.getElementById("model-a-label").className =
            `label-${a.label.toLowerCase()} mb-2`;
          document.getElementById("model-a-confidence").textContent =
            a.confidence;
          document.getElementById("model-a-latency").textContent = a.latency_ms;
          document.getElementById("model-a-progress").style.width =
            `${a.confidence * 100}%`;
          document.getElementById("model-a-progress").style.backgroundColor =
            a.label === "POSITIVE"
              ? "#28a745"
              : a.label === "NEUTRAL"
                ? "#ffc107"
                : "#dc3545";
          document.getElementById("model-a-name").textContent =
            `${a.model} • ${a.version}`;
          renderWords(
            "model-a-words",
            data.important_words || [],
            data.word_sentiments || [],
          );

          // ซ่อน Model B
          document.querySelector(".col-md-6:nth-child(2)").style.display =
            "none";
        }

        function renderWords(containerId, words, sentiments) {
          const container = document.getElementById(containerId);
          container.innerHTML = "";
          words.forEach((word, i) => {
            const span = document.createElement("span");
            span.textContent = word;
            span.className = `word-tag ${sentiments[i]}-word`;
            container.appendChild(span);
          });
        }
      });
    </script>
  </body>
</html>
